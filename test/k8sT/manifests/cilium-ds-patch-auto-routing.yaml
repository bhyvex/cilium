---
metadata:
  namespace: kube-system
spec:
  template:
    spec:
      containers:
      - image: docker.io/cilium/cilium:latest
        imagePullPolicy: IfNotPresent
        name: cilium-agent
        args:
        - "--debug=$(CILIUM_DEBUG)"
        - "--tunnel=disabled"
        - "--auto-routing"
        - "--kvstore=etcd"
        - "--kvstore-opt=etcd.config=/var/lib/etcd-config/etcd.config"
        - "--disable-ipv4=$(DISABLE_IPV4)"
        - "--log-system-load"
        - "--fixed-identity-mapping=128=kv-store"
        - "--fixed-identity-mapping=129=kube-dns"
      volumes:
      - name: etcd-secrets
        secret:
          secretName: cilium-etcd-client-tls
      dnsPolicy: ClusterFirstWithHostNet
